<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SL Skills Hub</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body.dark-mode {
      background-color: #111;
      color: white;
    }

    .card {
      border: 1px solid #ccc;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
    }

    .auth-info {
      margin-top: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #userPhoto {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: none;
    }

    input, button {
      padding: 8px;
      margin: 5px;
    }

    #skillForm {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>SL Skills Hub</h1>
    <p>Find skilled people near you in Sierra Leone</p>

    <!-- Google Auth Buttons -->
    <div class="auth-buttons">
      <button onclick="googleLogin()">Login with Google</button>
      <button onclick="googleLogout()">Logout</button>
      <div id="userInfo" class="auth-info">
        <img id="userPhoto" src="" alt="Profile" />
        <p id="userEmail"></p>
      </div>
    </div>

    <!-- Add Skill Button -->
    <button onclick="toggleForm()">Add Your Skill</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <input type="text" id="searchInput" oninput="filterSkills()" placeholder="Search skills..." />
  </header>
<img id="userPic" style="width:50px; height:50px; border-radius:50%; display:none;" />
  <!-- Skill Form -->
  <div id="skillForm" style="display:none;">
    <input type="text" id="name" placeholder="Your Name" />
    <input type="text" id="skill" placeholder="Your Skill" />
    <input type="text" id="location" placeholder="Your Location" />
    <input type="text" id="contact" placeholder="WhatsApp Link" />
    <button onclick="addSkill()">Submit</button>
  </div>

  <!-- Skills List -->
  <div id="skillCards"></div>

  <!-- Firebase App & Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
      authDomain: "sl-skills-hub.firebaseapp.com",
      projectId: "sl-skills-hub",
      storageBucket: "sl-skills-hub.appspot.com",
      messagingSenderId: "125049368940",
      appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    window.db = db;

   window.googleLogin = async function () {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    document.getElementById("userEmail").innerText = user.email;
    document.getElementById("userPic").src = user.photoURL;
    document.getElementById("userPic").style.display = "block";
  } catch (error) {
    alert("Login failed: " + error.message);
  }
}

    window.googleLogout = async function () {
      try {
        await signOut(auth);
        document.getElementById("userEmail").innerText = "";
        document.getElementById("userPhoto").style.display = "none";
      } catch (error) {
        alert("Logout failed: " + error.message);
      }
    }

    window.toggleForm = function () {
      const form = document.getElementById("skillForm");
      form.style.display = form.style.display === "none" ? "block" : "none";
    }

    window.toggleDarkMode = function () {
      document.body.classList.toggle("dark-mode");
    }
<script>
  window.addSkill = async function () {
    const name = document.getElementById("name").value;
    const skill = document.getElementById("skill").value;
    const userLocation = document.getElementById("location").value; // Renamed this
    const contact = document.getElementById("contact").value;

    if (!name || !skill || !userLocation || !contact) {
      alert("Please fill all fields.");
      return;
    }

    const newSkill = {
      name,
      skill,
      location: userLocation, // Use the renamed variable here
      contact
    };

    try {
      await addDoc(collection(db, "skills"), newSkill);
      alert("Skill added successfully!");
      location.reload(); // This will now work correctly
    } catch (e) {
      console.error("Error adding document:", e.message);
      alert("Failed to add skill: " + e.message);
    }
  };
</script>

window.createSkillCard = function (data, id) {
  const card = document.createElement("div");
  card.className = "card";

  const date = data.createdAt
    ? new Date(data.createdAt).toLocaleString()
    : "Date not available";

  card.innerHTML = `
    <h3>${data.name}</h3>
    <p><strong>Skill:</strong> ${data.skill}</p>
    <p><strong>Location:</strong> ${data.location}</p>
    <p><strong>Contact:</strong> <a href="${data.contact}" target="_blank">WhatsApp</a></p>
    <p><em>Posted on: ${date}</em></p>
    <button onclick="deleteSkill('${id}')">Delete</button>
  `;

  document.getElementById("skillCards").appendChild(card);
}
window.onload = () => {
  window.loadSkills();

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("userEmail").innerText = user.email;
      document.getElementById("userPic").src = user.photoURL;
      document.getElementById("userPic").style.display = "block";
    }
  });
};

    window.deleteSkill = async function (id) {
      try {
        await deleteDoc(doc(db, "skills", id));
        alert("Skill deleted.");
        location.reload();
      } catch (e) {
        alert("Failed to delete skill: " + e.message);
      }
    }

    window.filterSkills = function () {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const cards = document.querySelectorAll(".card");

      cards.forEach((card) => {
        const content = card.textContent.toLowerCase();
        card.style.display = content.includes(searchValue) ? "block" : "none";
      });
    }

    window.onload = () => {
      loadSkills();
      onAuthStateChanged(auth, (user) => {
        if (user) {
          document.getElementById("userEmail").innerText = user.displayName || user.email;
          document.getElementById("userPhoto").src = user.photoURL;
          document.getElementById("userPhoto").style.display = "inline";
        } else {
          document.getElementById("userEmail").innerText = "";
          document.getElementById("userPhoto").style.display = "none";
        }
      });
    };
  </script>
</body>
</html>
