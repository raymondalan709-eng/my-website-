<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SL Skills Hub</title>

  <!-- Firebase compat builds (works with old-style firebase.* API) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <style>
    /* --- Layout / Styles (keeps your blue header + white cards) --- */
    :root{--blue:#007BFF;--white:#fff}
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;margin:0;background:#f3f4f6}
    header{background:var(--blue);color:var(--white);padding:18px 12px;position:relative}
    header h1{margin:0;font-size:34px;text-align:center}
    header .intro{margin-top:8px;text-align:center;font-weight:700;font-size:18px;color:rgba(255,255,255,0.95)}
    /* top-left user box */
    #userBox{position:absolute;left:14px;top:12px;text-align:left;color:#fff}
    #userBox img{width:44px;height:44px;border-radius:50%;display:block;margin-bottom:6px}
    #userBox .name{font-weight:700;margin-bottom:6px}
    #userBox button{display:block;background:#fff;color:var(--blue);border:none;padding:6px 10px;border-radius:6px;cursor:pointer;margin-bottom:6px}
    /* header controls: add + search */
    .header-controls{display:flex;gap:10px;justify-content:center;margin-top:12px}
    .header-controls input[type="search"]{padding:10px;border-radius:8px;border:0;width:280px;max-width:70vw}
    .header-controls button{padding:10px 16px;border-radius:8px;border:0;background:#fff;color:var(--blue);font-weight:700;cursor:pointer}
    /* Add form */
    #formWrapper{max-width:520px;margin:20px auto;display:none}
    form.skill-form{background:#fff;padding:16px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .skill-form input{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ddd;box-sizing:border-box}
    .skill-form .row{display:flex;gap:10px}
    .skill-form .row input{flex:1}
    .skill-form button{background:var(--blue);color:#fff;border:0;padding:10px 14px;border-radius:6px;cursor:pointer;font-weight:700}
    /* skills list */
    #skillsArea{padding:18px 12px 60px;display:flex;flex-wrap:wrap;gap:14px;justify-content:center}
    .card{width:320px;background:#fff;border-radius:8px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.05);border:1px solid #eee}
    .card .top{display:flex;gap:12px;align-items:center}
    .card img{width:56px;height:56px;border-radius:50%;object-fit:cover}
    .card h3{margin:0;color:var(--blue)}
    .card p{margin:6px 0;color:#333}
    .card .small{font-size:13px;color:#666}
    .card .actions{margin-top:10px}
    .card .actions button{margin-right:8px;padding:6px 10px;border-radius:6px;border:0;cursor:pointer}
    .btn-edit{background:orange;color:#fff}
    .btn-delete{background:#e53935;color:#fff}
    /* responsive tweaks */
    @media (max-width:520px){ .header-controls input[type="search"]{width:180px} .card{width:90%} }
  </style>
</head>
<body>
  <header>
    <div id="userBox">
      <img id="userPhoto" src="" alt="profile" style="display:none" />
      <div id="userName" class="name" style="display:none"></div>
      <button id="loginBtn">Login with Google</button>
      <button id="logoutBtn" style="display:none">Logout</button>
    </div>

    <h1>SL Skills Hub</h1>
    <div class="intro">Find talented people near you</div>

    <div class="header-controls">
      <button id="openAddBtn">Add Skill</button>
      <input id="searchInput" type="search" placeholder="Search by name, skill or locationâ€¦" />
    </div>
  </header>

  <!-- Add / Edit form (we reuse same form for add & edit) -->
  <div id="formWrapper">
    <form id="skillForm" class="skill-form">
      <input type="hidden" id="skillId" value="">
      <input id="name" placeholder="Your name" required />
      <input id="skill" placeholder="Your skill" required />
      <input id="location" placeholder="Location (eg: Freetown)" required />
      <input id="whatsapp" placeholder="WhatsApp number (eg: +2327... or 07...)" required />
      <input id="picture" placeholder="Picture URL (leave blank to use your Google photo)" />
      <div style="display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:8px">
        <button type="submit" id="saveBtn">Save</button>
      </div>
    </form>
  </div>

  <!-- skills list -->
  <main id="skillsArea"></main>

<script>
/* === CONFIG: paste your Firebase config here exactly from Project Settings === */
const firebaseConfig = {
  apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
  authDomain: "sl-skills-hub.firebaseapp.com",
  projectId: "sl-skills-hub",
  storageBucket: "sl-skills-hub.firebasestorage.app",
  messagingSenderId: "125049368940",
  appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
};
/* ========================================================================== */

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

/* ------------ Helpers ------------ */
function normalizeWhatsApp(input) {
  if (!input) return "";
  input = input.trim();
  // if it is already a wa.me link, use it
  if (input.startsWith("https://wa.me/") || input.startsWith("http://wa.me/")) return input;
  // remove non digits
  let digits = input.replace(/\D/g,"");
  // allow starting with country code; if starts with 0 -> assume Sierra Leone 232
  if (digits.length && digits[0] === "0") digits = "232" + digits.slice(1);
  if (!digits.startsWith("232")) {
    // if short local number (like 7xxxxxxx) add 232
    if (digits.length <= 9) digits = "232" + digits;
  }
  return "https://wa.me/" + digits;
}
function formatDate(ts) {
  if (!ts) return "Date not available";
  try {
    if (ts.toDate) return ts.toDate().toLocaleString();
    // ts might be string
    const d = new Date(ts);
    return isNaN(d) ? String(ts) : d.toLocaleString();
  } catch (e) { return String(ts); }
}

/* ------------ Auth UI & events ------------ */
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const userPhoto = document.getElementById('userPhoto');
const userName = document.getElementById('userName');

loginBtn.addEventListener('click', () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider).catch(err=>{
    console.error("Login failed:", err);
    alert("Login failed: " + (err.message||err.code));
  });
});
logoutBtn.addEventListener('click', () => auth.signOut());

auth.onAuthStateChanged(user => {
  currentUser = user;
  if (user) {
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
    userPhoto.src = user.photoURL || "";
    userPhoto.style.display = user.photoURL ? 'block' : 'none';
    userName.textContent = user.displayName || user.email;
    userName.style.display = 'block';
    // prefill picture input with google photo for convenience
    document.getElementById('picture').value = user.photoURL || "";
  } else {
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
    userPhoto.style.display = 'none';
    userName.style.display = 'none';
    document.getElementById('picture').value = "";
  }
});

/* ------------ Add/Edit form logic ------------ */
const formWrapper = document.getElementById('formWrapper');
const openAddBtn = document.getElementById('openAddBtn');
const skillForm = document.getElementById('skillForm');
const saveBtn = document.getElementById('saveBtn');

openAddBtn.addEventListener('click', () => {
  if (!currentUser) return alert("Please log in to add a skill.");
  document.getElementById('skillId').value = "";
  skillForm.reset();
  // set picture default to current user's photo
  document.getElementById('picture').value = currentUser ? (currentUser.photoURL || "") : "";
  formWrapper.style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

skillForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (!currentUser) return alert("Please login first.");

  const id = document.getElementById('skillId').value || null;
  const name = document.getElementById('name').value.trim();
  const skill = document.getElementById('skill').value.trim();
  const location = document.getElementById('location').value.trim();
  const whatsappRaw = document.getElementById('whatsapp').value.trim();
  const pictureUrl = document.getElementById('picture').value.trim() || currentUser.photoURL || "";

  if (!name || !skill || !location || !whatsappRaw) {
    return alert("Please fill all fields.");
  }

  const whatsapp = normalizeWhatsApp(whatsappRaw);
  const payload = {
    uid: currentUser.uid,
    posterName: currentUser.displayName || currentUser.email,
    posterPhoto: currentUser.photoURL || "",
    name, skill, location, whatsapp, picture: pictureUrl,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  try {
    if (id) {
      // update
      await db.collection('skills').doc(id).update(payload);
    } else {
      // create
      await db.collection('skills').add(payload);
    }
    formWrapper.style.display = 'none';
    skillForm.reset();
    loadSkills(); // refresh
  } catch (err) {
    console.error("Save failed:", err);
    alert("Failed to save skill: " + (err.message || err.code));
  }
});

/* ------------ Render / Load skills (live) ------------ */
const skillsArea = document.getElementById('skillsArea');

function renderCard(doc) {
  const data = doc.data();
  const id = doc.id;
  const card = document.createElement('div');
  card.className = 'card';
  const picture = data.picture || data.posterPhoto || "";
  const dateStr = formatDate(data.createdAt || data.createdAtTimestamp || data.createdAtString || data.createdAt);
  card.innerHTML = `
    <div class="top">
      <img src="${picture || ''}" alt="pic" />
      <div style="flex:1">
        <h3>${escapeHtml(data.name||'Anonymous')}</h3>
        <p class="small"><strong>${escapeHtml(data.skill||'')}</strong></p>
      </div>
    </div>
    <p><strong>Location:</strong> ${escapeHtml(data.location||'')}</p>
    <p><strong>Contact:</strong> <a href="${escapeAttr(data.whatsapp||'')}" target="_blank" rel="noopener">WhatsApp</a></p>
    <p class="small">Posted on: ${dateStr}</p>
  `;

  // owner actions
  if (currentUser && data.uid === currentUser.uid) {
    const actions = document.createElement('div');
    actions.className = 'actions owner-actions';
    const editBtn = document.createElement('button');
    editBtn.className = 'btn-edit';
    editBtn.textContent = 'Edit';
    editBtn.onclick = () => startEdit(id, data);
    const delBtn = document.createElement('button');
    delBtn.className = 'btn-delete';
    delBtn.textContent = 'Delete';
    delBtn.onclick = async () => {
      if (!confirm('Delete this skill?')) return;
      try {
        await db.collection('skills').doc(id).delete();
      } catch (err) { alert('Delete failed: ' + (err.message||err.code)); }
    };
    actions.appendChild(editBtn);
    actions.appendChild(delBtn);
    card.appendChild(actions);
  }

  card.dataset.id = id;
  return card;
}

let unsubscribe = null;
function loadSkills() {
  // detach previous listener
  if (typeof unsubscribe === 'function') unsubscribe();

  unsubscribe = db.collection('skills').orderBy('createdAt','desc').onSnapshot(snapshot => {
    skillsArea.innerHTML = '';
    snapshot.forEach(doc => {
      const card = renderCard(doc);
      skillsArea.appendChild(card);
    });
    // run search filter if input has text
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    if (q) filterCards(q);
  }, err => {
    console.error("Listen failed:", err);
  });
}

/* ------------ Edit flow (prefill and save) ------------ */
function startEdit(id, data) {
  // prefill the form
  document.getElementById('skillId').value = id;
  document.getElementById('name').value = data.name || '';
  document.getElementById('skill').value = data.skill || '';
  document.getElementById('location').value = data.location || '';
  // show normalized whatsapp as digits or original
  document.getElementById('whatsapp').value = (data.whatsapp || '').replace(/^https?:\/\/wa\.me\//,'');
  document.getElementById('picture').value = data.picture || data.posterPhoto || '';
  formWrapper.style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ------------ search/filtering ------------ */
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', (e) => filterCards(e.target.value.toLowerCase()));
function filterCards(q) {
  document.querySelectorAll('.card').forEach(card => {
    const text = card.innerText.toLowerCase();
    card.style.display = text.includes(q) ? '' : 'none';
  });
}

/* ------------ util helpers (escape) ------------ */
function escapeHtml(s) {
  if (s==null) return '';
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function escapeAttr(s){ return s ? s : '#'; }

/* ------------ initial load when auth ready ------------ */
auth.onAuthStateChanged(user => {
  currentUser = user;
  // reload skills to update owner buttons
  loadSkills();
});

/* load initial */
loadSkills();
</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SL Skills Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #fff;
    }
    header {
      background-color: #007bff;
      color: white;
      padding: 10px;
      text-align: center;
      position: relative;
    }
    header h1 {
      margin: 0;
    }
    header p {
      font-size: 18px;
      font-weight: bold;
      margin: 5px 0 0 0;
    }
    #auth-section {
      position: absolute;
      top: 10px;
      left: 10px;
      text-align: center;
    }
    #auth-section img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: block;
      margin: 0 auto 5px auto;
    }
    #auth-section p {
      font-size: 14px;
      margin: 0 0 5px 0;
    }
    button {
      padding: 8px 12px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #login-btn {
      background-color: blue;
      color: white;
    }
    #logout-btn {
      background-color: blue;
      color: white;
    }
    #add-skill-btn, #search-bar {
      margin: 10px 0;
    }
    #add-skill-btn {
      background-color: white;
      color: #007bff;
      font-weight: bold;
    }
    #search-bar input {
      padding: 8px;
      width: 200px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<header>
  <div id="auth-section">
    <img id="user-pic" src="" style="display:none;">
    <p id="user-name" style="display:none;"></p>
    <button id="login-btn">Login with Google</button>
    <button id="logout-btn" style="display:none;">Logout</button>
  </div>
  <h1>SL Skills Hub</h1>
  <p>Find talented people near you</p>
  <button id="add-skill-btn">Add Skill</button>
  <div id="search-bar">
    <input type="text" id="searchInput" placeholder="Search skills...">
  </div>
</header>

<!-- Firebase v8 scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
    authDomain: "sl-skills-hub.firebaseapp.com",
    projectId: "sl-skills-hub",
    storageBucket:"sl-skills-hub.firebasestorage.app",
    messagingSenderId:"125049368940",
    appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const loginBtn = document.getElementById("login-btn");
  const logoutBtn = document.getElementById("logout-btn");
  const userPic = document.getElementById("user-pic");
  const userName = document.getElementById("user-name");

  // Google login
  loginBtn.addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(console.error);
  });

  // Logout
  logoutBtn.addEventListener("click", () => {
    auth.signOut();
  });

  // Auth state change
  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      userPic.src = user.photoURL;
      userPic.style.display = "block";
      userName.textContent = user.displayName;
      userName.style.display = "block";
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      userPic.style.display = "none";
      userName.style.display = "none";
    }
  });
</script>

</body>
</html>




