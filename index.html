<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SL Skills Hub</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body.dark-mode {
      background-color: #111;
      color: white;
    }

    .card {
      border: 1px solid #ccc;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
    }

    .auth-info {
      margin-top: 10px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #userPhoto {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: none;
    }

    input, button {
      padding: 8px;
      margin: 5px;
    }

    #skillForm {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>SL Skills Hub</h1>
    <p>Find skilled people near you in Sierra Leone</p>

    <!-- Google Auth Buttons -->
    <div class="auth-buttons">
      <button onclick="googleLogin()">Login with Google</button>
      <button onclick="googleLogout()">Logout</button>
      <div id="userInfo" class="auth-info">
        <img id="userPhoto" src="" alt="Profile" />
        <p id="userEmail"></p>
      </div>
    </div>

    <!-- Add Skill Button -->
    <button onclick="toggleForm()">Add Your Skill</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <input type="text" id="searchInput" oninput="filterSkills()" placeholder="Search skills..." />
  </header>
<img id="userPic" style="width:50px; height:50px; border-radius:50%; display:none;" />
  <!-- Skill Form -->
  <!-- Skill Form -->
<form id="skillForm" style="display: none;">
  <input type="text" id="name" placeholder="Name" required />
  <input type="text" id="skill" placeholder="Skill" required />
  <input type="text" id="location" placeholder="Location" required />
  <input type="text" id="contact" placeholder="WhatsApp Link" required />
  <button id="submitBtn" onclick="addSkill()">Submit Skill</button>
</form>

  <!-- Skills List -->
  <div id="skillCards"></div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    deleteDoc,
    updateDoc,
    doc,
    Timestamp,
  } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
    authDomain: "sl-skills-hub.firebaseapp.com",
    projectId: "sl-skills-hub",
    storageBucket: "sl-skills-hub.appspot.com",
    messagingSenderId: "125049368940",
    appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  window.db = db;

  let editingSkillId = null;

  window.googleLogin = async function () {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      document.getElementById("userEmail").innerText = user.email;
      document.getElementById("userPic").src = user.photoURL;
      document.getElementById("userPic").style.display = "inline";
    } catch (error) {
      alert("Login failed: " + error.message);
    }
  }

  window.googleLogout = async function () {
    try {
      await signOut(auth);
      document.getElementById("userEmail").innerText = "";
      document.getElementById("userPic").style.display = "none";
    } catch (error) {
      alert("Logout failed: " + error.message);
    }
  }

  window.toggleForm = function () {
    const form = document.getElementById("skillForm");
    form.style.display = form.style.display === "none" ? "block" : "none";
  }

  window.toggleDarkMode = function () {
    document.body.classList.toggle("dark-mode");
  }

  window.addSkill = async function () {
    const name = document.getElementById("name").value;
    const skill = document.getElementById("skill").value;
    const location = document.getElementById("location").value;
    const contact = document.getElementById("contact").value;

    if (!name || !skill || !location || !contact) {
      alert("Please fill all fields.");
      return;
    }

    const skillData = {
      name,
      skill,
      location,
      contact,
      createdAt: Timestamp.now()
    };

    try {
      if (editingSkillId) {
        const skillRef = doc(db, "skills", editingSkillId);
        await updateDoc(skillRef, skillData);
        alert("Skill updated!");
        editingSkillId = null;
        document.getElementById("submitBtn").innerText = "Submit Skill";
      } else {
        await addDoc(collection(db, "skills"), skillData);
        alert("Skill added!");
      }

      document.getElementById("skillForm").reset();
      toggleForm();
      loadSkills();
    } catch (e) {
      alert("Error saving skill: " + e.message);
    }
  }

  window.createSkillCard = function (data, id) {
    const card = document.createElement("div");
    card.className = "card";
    const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : "Unknown";
    card.innerHTML = `
      <h3>${data.name}</h3>
      <p><strong>Skill:</strong> ${data.skill}</p>
      <p><strong>Location:</strong> ${data.location}</p>
      <p><strong>Contact:</strong> <a href="${data.contact}" target="_blank">WhatsApp</a></p>
      <p><em>Posted on:</em> ${date}</p>
      <button onclick="editSkill('${id}', \`${data.name}\`, \`${data.skill}\`, \`${data.location}\`, \`${data.contact}\`)">Edit</button>
      <button onclick="deleteSkill('${id}')">Delete</button>
    `;
    document.getElementById("skillCards").appendChild(card);
  }

  window.editSkill = function (id, name, skill, location, contact) {
    editingSkillId = id;
    document.getElementById("name").value = name;
    document.getElementById("skill").value = skill;
    document.getElementById("location").value = location;
    document.getElementById("contact").value = contact;
    document.getElementById("submitBtn").innerText = "Update Skill";
    document.getElementById("skillForm").style.display = "block";
  }

  window.loadSkills = async function () {
    const container = document.getElementById("skillCards");
    container.innerHTML = "";
    try {
      const querySnapshot = await getDocs(collection(db, "skills"));
      querySnapshot.forEach((docSnap) => {
        createSkillCard(docSnap.data(), docSnap.id);
      });
    } catch (e) {
      console.error("Error loading skills:", e.message);
    }
  }

  window.deleteSkill = async function (id) {
    try {
      await deleteDoc(doc(db, "skills", id));
      alert("Skill deleted.");
      loadSkills();
    } catch (e) {
      alert("Failed to delete skill: " + e.message);
    }
  }

  window.filterSkills = function () {
    const searchValue = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.querySelectorAll(".card");

    cards.forEach((card) => {
      const content = card.textContent.toLowerCase();
      card.style.display = content.includes(searchValue) ? "block" : "none";
    });
  }

  window.onload = () => {
    loadSkills();
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById("userEmail").innerText = user.email;
        document.getElementById("userPic").src = user.photoURL;
        document.getElementById("userPic").style.display = "inline";
      }
    });
  }
</script>
