<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SL Skills Hub</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: white;
    }

    header {
      background: #007bff;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }

    #userInfo {
      position: absolute;
      top: 10px;
      left: 10px;
      text-align: left;
    }

    #userInfo img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      vertical-align: middle;
    }

    #userName {
      display: block;
      color: white;
      font-size: 14px;
      margin-top: 5px;
    }

    #authButtons {
      margin-top: 5px;
    }

    #authButtons button {
      margin: 2px;
      background: white;
      color: #007bff;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    #controls button, #searchInput {
      padding: 10px;
      border-radius: 5px;
      border: none;
    }

    #controls button {
      background: white;
      color: #007bff;
      font-weight: bold;
      cursor: pointer;
    }

    #searchInput {
      width: 80%;
      max-width: 300px;
    }

    #addSkillForm {
      margin: 20px auto;
      max-width: 400px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }

    #addSkillForm input {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .skill-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin: 20px;
      max-width: 400px;
    }

    .skill-card img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .skill-card .actions {
      margin-top: 10px;
    }

    .skill-card .actions button {
      margin-right: 10px;
      padding: 5px 10px;
      cursor: pointer;
    }

    #skillsContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
  </style>
</head>
<body>

<header>
  <div id="userInfo">
    <img id="userPic" src="" alt="Profile" style="display: none;">
    <span id="userName"></span>
    <div id="authButtons">
      <button id="loginBtn">Login with Google</button>
      <button id="logoutBtn" style="display: none;">Logout</button>
    </div>
  </div>
  <h1>SL Skills Hub</h1>
  <div id="controls">
    <button onclick="toggleAddSkill()">Add a Skill</button>
    <input type="text" id="searchInput" placeholder="Search skills..." oninput="searchSkills()">
  </div>
</header>

<div id="addSkillForm" style="display: none;">
  <input type="text" id="nameInput" placeholder="Your Name">
  <input type="text" id="skillInput" placeholder="Your Skill">
  <input type="text" id="locationInput" placeholder="Location">
  <input type="text" id="whatsappInput" placeholder="WhatsApp Contact">
  <button onclick="submitSkill()">Submit</button>
</div>

<div id="skillsContainer"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
    authDomain: "sl-skills-hub.firebaseapp.com",
    projectId: "sl-skills-hub",
    storageBucket: "sl-skills-hub.appspot.com",
    messagingSenderId: "1033166112639",
    appId: "1:1033166112639:web:264401b2f0e801b842c32c"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      document.getElementById('logoutBtn').style.display = 'inline-block';
      document.getElementById('loginBtn').style.display = 'none';
      document.getElementById('userPic').src = user.photoURL;
      document.getElementById('userPic').style.display = 'inline-block';
      document.getElementById('userName').innerText = user.displayName;
      loadSkills();
    } else {
      document.getElementById('logoutBtn').style.display = 'none';
      document.getElementById('loginBtn').style.display = 'inline-block';
      document.getElementById('userPic').style.display = 'none';
      document.getElementById('userName').innerText = '';
    }
  });

  document.getElementById('loginBtn').addEventListener('click', () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  });

  document.getElementById('logoutBtn').addEventListener('click', () => {
    auth.signOut();
  });

  function toggleAddSkill() {
    const form = document.getElementById('addSkillForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  }

  function submitSkill() {
    if (!currentUser) return alert("Please login first.");

    const name = document.getElementById('nameInput').value;
    const skill = document.getElementById('skillInput').value;
    const location = document.getElementById('locationInput').value;
    const whatsapp = document.getElementById('whatsappInput').value;
    const photoURL = currentUser.photoURL;
    const uid = currentUser.uid;
    const date = new Date().toLocaleString();

    db.collection("skills").add({
      name, skill, location, whatsapp, photoURL, uid, date
    }).then(() => {
      document.getElementById('addSkillForm').reset();
      toggleAddSkill();
      loadSkills();
    });
  }

  function loadSkills() {
    db.collection("skills").get().then(snapshot => {
      const container = document.getElementById('skillsContainer');
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement('div');
        card.className = "skill-card";
        card.innerHTML = `
          <img src="${data.photoURL || ''}" alt="User">
          <h3>${data.name}</h3>
          <p><strong>Skill:</strong> ${data.skill}</p>
          <p><strong>Location:</strong> ${data.location}</p>
          <p><strong>WhatsApp:</strong> <a href="https://wa.me/${data.whatsapp}" target="_blank">${data.whatsapp}</a></p>
          <p><strong>Date:</strong> ${data.date}</p>
          <div class="actions">
            ${currentUser && currentUser.uid === data.uid ? `
              <button onclick="editSkill('${doc.id}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">Edit</button>
              <button onclick="deleteSkill('${doc.id}')">Delete</button>
            ` : ''}
          </div>
        `;
        container.appendChild(card);
      });
    });
  }

  function deleteSkill(id) {
    if (confirm("Delete this skill?")) {
      db.collection("skills").doc(id).delete().then(loadSkills);
    }
  }

  function editSkill(id, data) {
    const name = prompt("Edit Name", data.name);
    const skill = prompt("Edit Skill", data.skill);
    const location = prompt("Edit Location", data.location);
    const whatsapp = prompt("Edit WhatsApp", data.whatsapp);

    if (name && skill && location && whatsapp) {
      db.collection("skills").doc(id).update({
        name, skill, location, whatsapp
      }).then(loadSkills);
    }
  }

  function searchSkills() {
    const term = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.querySelectorAll(".skill-card");
    cards.forEach(card => {
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(term) ? "block" : "none";
    });
  }
</script>

</body>
</html>
