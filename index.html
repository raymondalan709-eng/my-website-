<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SL Skills Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #fff;
    }
    header {
      background: #007bff;
      color: white;
      padding: 15px;
      text-align: center;
      position: relative;
    }
    header img.logo {
      width: 40px;
      height: 40px;
      vertical-align: middle;
      margin-right: 10px;
    }
    header h1 {
      display: inline;
      font-size: 28px;
    }
    header p {
      margin: 5px 0 0;
      font-weight: bold;
    }
    #authSection {
      position: absolute;
      top: 10px;
      left: 10px;
      text-align: left;
    }
    #authSection img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: block;
    }
    #authSection p {
      margin: 5px 0;
      font-size: 14px;
    }
    button {
      background: #007bff;
      border: none;
      color: white;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    #searchBar {
      padding: 8px;
      width: 60%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #addSkillSection {
      text-align: center;
      margin: 20px;
    }
    #addSkillSection input {
      display: block;
      margin: 10px auto;
      padding: 8px;
      width: 80%;
      max-width: 400px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .skill-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin: 15px;
      display: inline-block;
      width: 250px;
      vertical-align: top;
      background: #f9f9f9;
      transition: transform 0.2s;
    }
    .skill-card:hover {
      transform: scale(1.03);
    }
    .skill-card img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: block;
      margin: 0 auto 10px;
    }
    .card-buttons {
      text-align: center;
      margin-top: 10px;
    }
    .card-buttons button {
      display: inline-block;
      width: 45%;
      margin: 2px;
    }
    .whatsapp-link {
      display: block;
      margin-top: 10px;
      text-align: center;
      background: #25D366;
      color: white;
      padding: 5px;
      border-radius: 5px;
      text-decoration: none;
    }
    /* Mobile Responsive */
    @media (max-width: 600px) {
      header h1 { font-size: 22px; }
      #searchBar { width: 90%; }
      .skill-card { width: 90%; }
    }
  </style>
</head>
<body>
  <header>
    <img src="1755377954769.jpeg" alt="SLSH Logo" class="logo">
    <h1>SL Skills Hub</h1>
    <p>find talented people near you</p>
    <div id="authSection">
      <img id="userPic" src="" style="display:none;">
      <p id="userName"></p>
      <button id="loginBtn">Login with Google</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
    <input type="text" id="searchBar" placeholder="Search skills...">
  </header>

  <div id="addSkillSection" style="display:none;">
    <h2>Add a Skill</h2>
    <input type="text" id="nameInput" placeholder="Your Name">
    <input type="text" id="skillInput" placeholder="Skill">
    <input type="text" id="locationInput" placeholder="Location">
    <input type="text" id="whatsappInput" placeholder="WhatsApp Number">
    <input type="file" id="photoInput" accept="image/*">
    <button onclick="addSkill()">Add Skill</button>
  </div>

  <div id="skillsContainer"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
      authDomain: "sl-skills-hub.firebaseapp.com",
      projectId: "sl-skills-hub",
      storageBucket: "sl-skills-hub.firebasestorage.app",
      messagingSenderId: "125049368940",
      appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    let currentUser = null;

    // Google Login
    document.getElementById("loginBtn").addEventListener("click", () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut();
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("userPic").src = user.photoURL;
        document.getElementById("userPic").style.display = "block";
        document.getElementById("userName").textContent = user.displayName;
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "block";
        document.getElementById("addSkillSection").style.display = "block";
      } else {
        currentUser = null;
        document.getElementById("userPic").style.display = "none";
        document.getElementById("userName").textContent = "";
        document.getElementById("loginBtn").style.display = "block";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("addSkillSection").style.display = "none";
      }
      loadSkills();
    });

    async function addSkill() {
      const name = document.getElementById("nameInput").value;
      const skill = document.getElementById("skillInput").value;
      const location = document.getElementById("locationInput").value;
      const whatsapp = document.getElementById("whatsappInput").value;
      const photoFile = document.getElementById("photoInput").files[0];
      let photoURL = currentUser.photoURL;

      if (photoFile) {
        const storageRef = storage.ref("skills/" + Date.now() + "_" + photoFile.name);
        await storageRef.put(photoFile);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.collection("skills").add({
        name, skill, location, whatsapp,
        photoURL,
        userId: currentUser.uid,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      loadSkills();
    }

    async function loadSkills() {
      const container = document.getElementById("skillsContainer");
      container.innerHTML = "";
      const snapshot = await db.collection("skills").orderBy("createdAt","desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "skill-card";
        card.innerHTML = `
          <img src="${data.photoURL}" alt="User Photo">
          <h3>${data.name}</h3>
          <p><b>Skill:</b> ${data.skill}</p>
          <p><b>Location:</b> ${data.location}</p>
          <a href="https://wa.me/${data.whatsapp}" target="_blank" class="whatsapp-link">Contact on WhatsApp</a>
        `;
        if (currentUser && currentUser.uid === data.userId) {
          const btns = document.createElement("div");
          btns.className = "card-buttons";
          btns.innerHTML = `
            <button onclick="editSkill('${doc.id}')">Edit</button>
            <button onclick="deleteSkill('${doc.id}')">Delete</button>
          `;
          card.appendChild(btns);
        }
        container.appendChild(card);
      });
    }

    async function deleteSkill(id) {
      await db.collection("skills").doc(id).delete();
      loadSkills();
    }

    async function editSkill(id) {
      const newSkill = prompt("Enter updated skill:");
      if (newSkill) {
        await db.collection("skills").doc(id).update({ skill: newSkill });
        loadSkills();
      }
    }

    // Search
    document.getElementById("searchBar").addEventListener("input", async (e) => {
      const searchValue = e.target.value.toLowerCase();
      const container = document.getElementById("skillsContainer");
      container.innerHTML = "";
      const snapshot = await db.collection("skills").orderBy("createdAt","desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.skill.toLowerCase().includes(searchValue) || data.name.toLowerCase().includes(searchValue)) {
          const card = document.createElement("div");
          card.className = "skill-card";
          card.innerHTML = `
            <img src="${data.photoURL}" alt="User Photo">
            <h3>${data.name}</h3>
            <p><b>Skill:</b> ${data.skill}</p>
            <p><b>Location:</b> ${data.location}</p>
            <a href="https://wa.me/${data.whatsapp}" target="_blank" class="whatsapp-link">Contact on WhatsApp</a>
          `;
          container.appendChild(card);
        }
      });
    });
  </script>
</body>
</html>
