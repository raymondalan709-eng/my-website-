<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SL Skills Hub</title>
<style>
  /* Your original CSS exactly as before */
  body {
    font-family: Arial, sans-serif;
    background-color: white;
    color: black;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #4CAF50;
    padding: 10px;
    color: white;
    text-align: center;
  }
  #skillForm {
    margin: 20px;
  }
  input, button, select {
    padding: 8px;
    margin: 5px 0;
    font-size: 1rem;
  }
  #skillsList {
    margin: 20px;
    list-style-type: none;
    padding: 0;
  }
  #skillsList li {
    background-color: #f4f4f4;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
  }
  .skill-header {
    font-weight: bold;
  }
  .skill-buttons button {
    margin-left: 10px;
  }
  /* Dark mode button style */
  #darkModeToggle {
    position: fixed;
    top: 10px;
    right: 10px;
  }
</style>
</head>
<body>

<header>
  <h1>SL Skills Hub</h1>
</header>

<button id="darkModeToggle">Toggle Dark Mode</button>

<form id="skillForm">
  <input type="text" id="skillName" placeholder="Skill name" required />
  <select id="skillCategory" required>
    <option value="">Select category</option>
    <option value="Web Development">Web Development</option>
    <option value="Mobile Apps">Mobile Apps</option>
    <option value="Data Science">Data Science</option>
    <option value="Other">Other</option>
  </select>
  <button type="submit">Add Skill</button>
</form>

<input type="text" id="searchInput" placeholder="Search skills..." />

<ul id="skillsList"></ul>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
  // Firebase config (replace with your actual config)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Admin UID - ONLY this UID can edit/delete all skills
  const ADMIN_UID = "I5WY1FJzNibUDOCzCBdGWPtX9Nj1";

  // DOM Elements
  const skillForm = document.getElementById('skillForm');
  const skillNameInput = document.getElementById('skillName');
  const skillCategorySelect = document.getElementById('skillCategory');
  const skillsList = document.getElementById('skillsList');
  const searchInput = document.getElementById('searchInput');
  const darkModeToggle = document.getElementById('darkModeToggle');

  let currentUser = null;
  let skillsData = [];

  // Dark mode toggle
  darkModeToggle.addEventListener('click', () => {
    document.body.style.backgroundColor = document.body.style.backgroundColor === 'black' ? 'white' : 'black';
    document.body.style.color = document.body.style.color === 'white' ? 'black' : 'white';
  });

  // User Login via Google
  function signIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(console.error);
  }

  function signOut() {
    auth.signOut();
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      console.log("Logged in as:", user.displayName);
      loadSkills();
    } else {
      currentUser = null;
      console.log("Not logged in");
      skillsList.innerHTML = "<li>Please log in to see skills.</li>";
      signIn();
    }
  });

  // Add skill to Firestore
  skillForm.addEventListener('submit', e => {
    e.preventDefault();
    if (!currentUser) {
      alert("Please log in first.");
      return;
    }
    const name = skillNameInput.value.trim();
    const category = skillCategorySelect.value;
    if (!name || !category) return;

    const newSkill = {
      name,
      category,
      userId: currentUser.uid,
      userName: currentUser.displayName || "Anonymous",
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    };

    db.collection('skills').add(newSkill)
      .then(() => {
        skillNameInput.value = '';
        skillCategorySelect.value = '';
        loadSkills();
      })
      .catch(console.error);
  });

  // Load skills from Firestore
  function loadSkills() {
    db.collection('skills').orderBy('createdAt', 'desc').get()
      .then(snapshot => {
        skillsData = [];
        snapshot.forEach(doc => {
          let skill = doc.data();
          skill.id = doc.id;
          skillsData.push(skill);
        });
        displaySkills(skillsData);
      })
      .catch(console.error);
  }

  // Display skills filtered by search
  function displaySkills(skills) {
    const filterText = searchInput.value.toLowerCase();
    skillsList.innerHTML = '';

    skills.filter(skill => 
      skill.name.toLowerCase().includes(filterText) ||
      skill.category.toLowerCase().includes(filterText) ||
      (skill.userName && skill.userName.toLowerCase().includes(filterText))
    ).forEach(skill => {
      const li = document.createElement('li');

      // Skill info
      let dateStr = '';
      if (skill.createdAt && skill.createdAt.toDate) {
        dateStr = ' - ' + skill.createdAt.toDate().toLocaleString();
      }

      li.innerHTML = `
        <span class="skill-header">${skill.name}</span> (${skill.category}) by ${skill.userName || 'Unknown'}${dateStr}
        <span class="skill-buttons"></span>
      `;

      // Buttons container
      const btns = li.querySelector('.skill-buttons');

      // Only admin or skill owner can edit/delete
      if (currentUser && (currentUser.uid === ADMIN_UID || currentUser.uid === skill.userId)) {
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', () => {
          editSkill(skill);
        });
        btns.appendChild(editBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Delete skill "${skill.name}"?`)) {
            db.collection('skills').doc(skill.id).delete().then(loadSkills);
          }
        });
        btns.appendChild(deleteBtn);
      }

      skillsList.appendChild(li);
    });
  }

  // Edit skill
  function editSkill(skill) {
    const newName = prompt("Edit skill name:", skill.name);
    if (newName === null) return; // cancelled
    const newCategory = prompt("Edit category:", skill.category);
    if (newCategory === null) return; // cancelled

    if (newName.trim() === '' || newCategory.trim() === '') {
      alert("Name and category cannot be empty.");
      return;
    }

    db.collection('skills').doc(skill.id).update({
      name: newName.trim(),
      category: newCategory.trim()
    }).then(loadSkills)
      .catch(console.error);
  }

  // Search input listener
  searchInput.addEventListener('input', () => {
    displaySkills(skillsData);
  });

</script>

</body>
</html>
