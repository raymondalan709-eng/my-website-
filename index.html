<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SL Skills Hub</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#fff; }
    header { background:#2196F3; color:white; padding:15px; text-align:center; }
    header h1 { margin:5px 0; font-size:28px; }
    header p { margin:0; font-weight:bold; font-size:18px; }
    #auth { position:absolute; top:10px; right:10px; }
    #auth img { width:30px; height:30px; border-radius:50%; vertical-align:middle; }
    #auth span { margin-right:10px; font-weight:bold; }
    #searchBar { width:90%; max-width:400px; padding:8px; margin:10px auto; display:block; border:1px solid #ccc; border-radius:4px; }
    #addSkillForm, #categoryForm { text-align:center; margin:15px; }
    #skillsList { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; padding:15px; }
    .skill-card { border:1px solid #ddd; padding:10px; border-radius:8px; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .skill-card img { width:50px; height:50px; border-radius:50%; }
    .skill-actions { margin-top:10px; }
    .skill-actions button { margin-right:5px; padding:5px 10px; border:none; border-radius:4px; cursor:pointer; }
    .share-buttons { text-align:center; margin:10px; }
    .share-buttons a { margin:5px; padding:8px 12px; border-radius:4px; color:white; text-decoration:none; display:inline-block; }
    .whatsapp { background:#25D366; }
    .facebook { background:#3b5998; }
    .twitter { background:#1DA1F2; }
    @media(max-width:600px){ #searchBar{width:95%;} }
  </style>
</head>
<body>
  <div id="auth">
    <span id="userName"></span>
    <img id="userPic" src="" alt="" style="display:none;">
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>

  <header>
    <h1>SL Skills Hub</h1>
    <p>Find talented people near you</p>
    <input type="text" id="searchBar" placeholder="Search skills...">
    <div>
      <select id="categoryFilter"><option value="">All Categories</option></select>
      <input type="text" id="newCategory" placeholder="New Category">
      <button id="addCategoryBtn">Add Category</button>
    </div>
  </header>

  <div class="share-buttons">
    <a class="whatsapp" target="_blank">WhatsApp</a>
    <a class="facebook" target="_blank">Facebook</a>
    <a class="twitter" target="_blank">Twitter</a>
  </div>

  <div id="addSkillForm">
    <h3>Add a Skill</h3>
    <input id="name" placeholder="Your Name"><br><br>
    <input id="skill" placeholder="Skill"><br><br>
    <input id="location" placeholder="Location"><br><br>
    <input id="whatsapp" placeholder="WhatsApp"><br><br>
    <button id="saveSkillBtn">Save Skill</button>
  </div>

  <div id="skillsList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      projectId: "YOUR-PROJECT-ID",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "YOUR-SENDER-ID",
      appId: "YOUR-APP-ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn=document.getElementById("loginBtn");
    const logoutBtn=document.getElementById("logoutBtn");
    const userName=document.getElementById("userName");
    const userPic=document.getElementById("userPic");
    let currentUser=null;

    loginBtn.onclick=()=>{
      const provider=new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };
    logoutBtn.onclick=()=>auth.signOut();

    auth.onAuthStateChanged(user=>{
      if(user){
        currentUser=user;
        loginBtn.style.display="none";
        logoutBtn.style.display="inline-block";
        userName.textContent=user.displayName;
        userPic.src=user.photoURL||"https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png";
        userPic.style.display="inline-block";
        loadSkills();
      } else {
        currentUser=null;
        loginBtn.style.display="inline-block";
        logoutBtn.style.display="none";
        userName.textContent="";
        userPic.style.display="none";
        skillsList.innerHTML="";
      }
    });

    document.getElementById("saveSkillBtn").onclick=async()=>{
      if(!currentUser){alert("Please login first");return;}
      const name=document.getElementById("name").value;
      const skill=document.getElementById("skill").value;
      const location=document.getElementById("location").value;
      const whatsapp=document.getElementById("whatsapp").value;
      if(name&&skill&&location&&whatsapp){
        await db.collection("skills").add({
          name, skill, location, whatsapp,
          userId: currentUser.uid,
          userPic: currentUser.photoURL||"https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png",
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    };

    function loadSkills(){
      db.collection("skills").orderBy("timestamp","desc").onSnapshot(snapshot=>{
        skillsList.innerHTML="";
        snapshot.forEach(doc=>{
          const data=doc.data();
          const card=document.createElement("div");
          card.className="skill-card";
          const date=data.timestamp?data.timestamp.toDate().toLocaleString():"";
          card.innerHTML=`
            <img src="${data.userPic || 'https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png'}" alt="">
            <h3>${data.name}</h3>
            <p><strong>Skill:</strong> ${data.skill}</p>
            <p><strong>Location:</strong> ${data.location}</p>
            <p><strong>WhatsApp:</strong> <a href="https://wa.me/${data.whatsapp}" target="_blank">${data.whatsapp}</a></p>
            <p><em>Posted on: ${date}</em></p>
          `;

          // Show edit/delete for owner, OR if userId missing (old skill)
          if(currentUser && (!data.userId || currentUser.uid===data.userId)){
            const actions=document.createElement("div"); actions.className="skill-actions";
            const editBtn=document.createElement("button"); editBtn.textContent="Edit";
            const delBtn=document.createElement("button"); delBtn.textContent="Delete";
            actions.appendChild(editBtn); actions.appendChild(delBtn); card.appendChild(actions);

            editBtn.onclick=async()=>{
              const newName=prompt("Update name:", data.name);
              const newSkill=prompt("Update skill:", data.skill);
              const newLoc=prompt("Update location:", data.location);
              const newWhats=prompt("Update WhatsApp:", data.whatsapp);
              if(newName&&newSkill&&newLoc&&newWhats){
                await db.collection("skills").doc(doc.id).update({
                  name:newName, skill:newSkill, location:newLoc, whatsapp:newWhats
                });
              }
            };
            delBtn.onclick=()=>{ if(confirm("Delete this skill?")) db.collection("skills").doc(doc.id).delete(); };
          }

          skillsList.appendChild(card);
        });
      });
    }

    // Search
    document.getElementById("searchBar").addEventListener("input", e=>{
      const search=e.target.value.toLowerCase();
      Array.from(skillsList.children).forEach(card=>{
        card.style.display=card.textContent.toLowerCase().includes(search)?"block":"none";
      });
    });

    // Share buttons
    const pageUrl=encodeURIComponent(window.location.href);
    document.querySelector(".whatsapp").href=`https://wa.me/?text=Check%20out%20SL%20Skills%20Hub%20${pageUrl}`;
    document.querySelector(".facebook").href=`https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
    document.querySelector(".twitter").href=`https://twitter.com/intent/tweet?url=${pageUrl}&text=Check%20out%20SL%20Skills%20Hub`;
  </script>
</body>
</html>
