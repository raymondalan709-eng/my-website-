<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SL Skills Hub</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #fff; }
    header { background: #2196F3; color: white; padding: 20px; text-align: center; }
    header h1 { margin: 0; font-size: 2.5em; font-weight: bold; }
    header p { margin: 5px 0 15px; font-size: 1.2em; font-weight: bold; }
    #authSection { position: absolute; top: 15px; left: 15px; text-align: left; }
    #authSection img { width: 40px; height: 40px; border-radius: 50%; display: block; margin-bottom: 5px; }
    #authSection p { margin: 0 0 5px; font-weight: bold; color: white; }
    #controls { margin-top: 15px; }
    #controls input, #controls button, #controls select {
      padding: 10px; margin: 5px; border: none; border-radius: 5px;
    }
    #controls input { width: 200px; }
    #controls button { background: white; color: #2196F3; cursor: pointer; font-weight: bold; }
    #controls button:hover { background: #f1f1f1; }
    #addSkillForm { display: none; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; background: #f9f9f9; }
    #addSkillForm input, #addSkillForm select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
    #skillsContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; padding: 20px; }
    .skillCard { border: 1px solid #ddd; border-radius: 10px; padding: 15px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .skillCard img { width: 60px; height: 60px; border-radius: 50%; }
    .skillCard h3 { margin: 10px 0 5px; }
    .skillCard p { margin: 3px 0; }
    .skillCard button { margin: 5px 5px 0 0; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
    .editBtn { background: #ffc107; color: white; }
    .deleteBtn { background: #f44336; color: white; }
    @media(max-width:640px){ #controls input{width:150px;} }
  </style>
</head>
<body>
  <header>
    <div id="authSection">
      <img id="userPic" src="" style="display:none;">
      <p id="userName"></p>
      <button id="loginBtn">Login with Google</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
    <h1>SL Skills Hub</h1>
    <p>Find talented people near you</p>
    <div id="controls">
      <input type="text" id="searchInput" placeholder="Search skills...">
      <button onclick="toggleAddSkill()">Add a Skill</button>
      <select id="categoryFilter"><option value="">All Categories</option></select>
      <div id="adminCategory" style="display:none;">
        <input type="text" id="newCategoryInput" placeholder="New Category">
        <button onclick="addCategory()">Add Category</button>
      </div>
      <!-- ✅ Share button -->
      <button onclick="shareSite()">Share</button>
    </div>
  </header>

  <div id="addSkillForm">
    <h2 id="formTitle">Add a Skill</h2>
    <input type="text" id="name" placeholder="Your Name">
    <input type="text" id="skill" placeholder="Skill">
    <input type="text" id="location" placeholder="Location">
    <input type="text" id="whatsapp" placeholder="WhatsApp Contact">
    <select id="categorySelect"></select>
    <button onclick="submitSkill()">Post Skill</button>
    <button onclick="cancelEdit()">Cancel</button>
  </div>

  <div id="skillsContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // ====== PASTE YOUR FIREBASE CONFIG HERE ======
   const firebaseConfig = {
  apiKey: "AIzaSyBWy9ffEDL3OugOpRbHrvDjGbQ3fkPGU4Y",
  authDomain: "sl-skills-hub.firebaseapp.com",
  projectId: "sl-skills-hub",
  storageBucket: "sl-skills-hub.firebasestorage.app",
  messagingSenderId: "125049368940",
  appId: "1:125049368940:web:76d4a47aa9eb7c43914349"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userPic = document.getElementById("userPic");
    const userName = document.getElementById("userName");
    const skillsContainer = document.getElementById("skillsContainer");
    const addSkillForm = document.getElementById("addSkillForm");
    const formTitle = document.getElementById("formTitle");
    const nameInput = document.getElementById("name");
    const skillInput = document.getElementById("skill");
    const locationInput = document.getElementById("location");
    const whatsappInput = document.getElementById("whatsapp");
    const categorySelect = document.getElementById("categorySelect");
    const categoryFilter = document.getElementById("categoryFilter");
    const adminCategory = document.getElementById("adminCategory");
    const newCategoryInput = document.getElementById("newCategoryInput");
    let currentUser = null;
    let editId = null;

    const adminUID = "I5WY1FJzNibUDOCzCBdGWPtX9Nj1";

    loginBtn.onclick = () => signInWithPopup(auth, provider);
    logoutBtn.onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      if(user){
        currentUser = user;
        userPic.src = user.photoURL;
        userPic.style.display = "block";
        userName.textContent = user.displayName;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "block";
        nameInput.value = user.displayName;
        if(user.uid === adminUID){ adminCategory.style.display = "block"; }
      } else {
        currentUser = null;
        userPic.style.display = "none";
        userName.textContent = "";
        loginBtn.style.display = "block";
        logoutBtn.style.display = "none";
        adminCategory.style.display = "none";
      }
    });

    function toggleAddSkill(){
      addSkillForm.style.display = addSkillForm.style.display === "none" ? "block" : "none";
    }
    function cancelEdit(){
      editId = null;
      formTitle.textContent = "Add a Skill";
      addSkillForm.style.display = "none";
      nameInput.value = currentUser ? currentUser.displayName : "";
      skillInput.value = "";
      locationInput.value = "";
      whatsappInput.value = "";
      categorySelect.value = "";
    }

    async function submitSkill(){
      if(!currentUser) return alert("Please login first!");
      const data = {
        uid: currentUser.uid,
        name: nameInput.value,
        skill: skillInput.value,
        location: locationInput.value,
        whatsapp: whatsappInput.value,
        category: categorySelect.value,
        photoURL: currentUser.photoURL,
        timestamp: new Date().toLocaleString()
      };
      if(editId){
        await updateDoc(doc(db,"skills",editId), data);
        editId = null;
        formTitle.textContent = "Add a Skill";
      } else {
        await addDoc(collection(db,"skills"), data);
      }
      cancelEdit();
    }

    async function loadCategories(){
      const snap = await getDocs(collection(db,"categories"));
      categorySelect.innerHTML = "";
      categoryFilter.innerHTML = "<option value=''>All Categories</option>";
      snap.forEach(docu=>{
        const opt1=document.createElement("option");
        opt1.value=docu.data().name;
        opt1.textContent=docu.data().name;
        categorySelect.appendChild(opt1);
        const opt2=opt1.cloneNode(true);
        categoryFilter.appendChild(opt2);
      });
    }

    async function addCategory(){
      if(!currentUser || currentUser.uid !== adminUID) return;
      const cat=newCategoryInput.value.trim();
      if(cat==="") return;
      await setDoc(doc(db,"categories",cat),{name:cat});
      newCategoryInput.value="";
      loadCategories();
    }

    function renderSkills(skills){
      skillsContainer.innerHTML="";
      skills.forEach(docu=>{
        const s=docu.data();
        const card=document.createElement("div");
        card.className="skillCard";
        card.innerHTML=`
          <img src="${s.photoURL}" alt="Profile">
          <h3>${s.name}</h3>
          <p><strong>Skill:</strong> ${s.skill}</p>
          <p><strong>Location:</strong> ${s.location}</p>
          <p><strong>WhatsApp:</strong> ${s.whatsapp}</p>
          <p><strong>Category:</strong> ${s.category||""}</p>
          <p><em>${s.timestamp}</em></p>
        `;
        if(currentUser && currentUser.uid===s.uid){
          const editBtn=document.createElement("button");
          editBtn.textContent="Edit"; editBtn.className="editBtn";
          editBtn.onclick=()=>{
            editId=docu.id;
            formTitle.textContent="Edit Skill";
            nameInput.value=s.name;
            skillInput.value=s.skill;
            locationInput.value=s.location;
            whatsappInput.value=s.whatsapp;
            categorySelect.value=s.category||"";
            addSkillForm.style.display="block";
          };
          const deleteBtn=document.createElement("button");
          deleteBtn.textContent="Delete"; deleteBtn.className="deleteBtn";
          deleteBtn.onclick=()=>deleteDoc(doc(db,"skills",docu.id));
          card.appendChild(editBtn);
          card.appendChild(deleteBtn);
        }
        skillsContainer.appendChild(card);
      });
    }

    const q=query(collection(db,"skills"),orderBy("timestamp","desc"));
    onSnapshot(q,snap=>{
      const all=[]; snap.forEach(d=>all.push(d));
      renderSkills(all);
    });

    document.getElementById("searchInput").addEventListener("input",async e=>{
      const val=e.target.value.toLowerCase();
      const snap=await getDocs(collection(db,"skills"));
      const results=[];
      snap.forEach(d=>{
        const s=d.data();
        if(
          s.name.toLowerCase().includes(val)||
          s.skill.toLowerCase().includes(val)||
          s.location.toLowerCase().includes(val)||
          s.whatsapp.toLowerCase().includes(val)||
          (s.category||"").toLowerCase().includes(val)
        ){ results.push(d); }
      });
      renderSkills(results);
    });

    categoryFilter.addEventListener("change",async e=>{
      const cat=e.target.value;
      const snap=await getDocs(collection(db,"skills"));
      const results=[];
      snap.forEach(d=>{
        const s=d.data();
        if(cat===""||s.category===cat) results.push(d);
      });
      renderSkills(results);
    });

    loadCategories();

    // ✅ Share function
    function shareSite(){
      if(navigator.share){
        navigator.share({
          title: "SL Skills Hub",
          text: "Check out this amazing skills hub!",
          url: window.location.href
        });
      } else {
        alert("Sharing not supported. Copy this link: " + window.location.href);
      }
    }
  </script>
</body>
</html>
